<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package
    Name="Orca"
    Manufacturer="vanthaita"
    Version="$(var.Version)"
    UpgradeCode="6E7B76E3-2D0A-45A0-8E6C-0E0B3F8C8C15"
    InstallerVersion="500"
    Compressed="yes"
    Scope="perMachine"
  >
    <MajorUpgrade AllowDowngrades="yes" />

    <MediaTemplate EmbedCab="yes" />

    <Icon Id="OrcaAppIcon" SourceFile="client\app\favicon.ico" />
    <Property Id="ARPPRODUCTICON" Value="OrcaAppIcon" />

    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLDIR" Name="Orca">
        <Directory Id="INSTALLFOLDER" Name="bin" />
      </Directory>
    </StandardDirectory>

    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="OrcaProgramMenuFolder" Name="Orca" />
    </StandardDirectory>

    <Feature Id="MainFeature" Title="Orca" Level="1">
      <ComponentGroupRef Id="OrcaComponents" />
      <ComponentGroupRef Id="OrcaShortcuts" />
    </Feature>

    <ui:WixUI Id="InstallDir" InstallDirectory="INSTALLDIR" />
    <WixVariable Id="WixUILicenseRtf" Value="installer/License.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="client\app\favicon.ico" />

    <ComponentGroup Id="OrcaComponents" Directory="INSTALLFOLDER">
      <Component Id="OrcaExeComponent" Guid="*">
        <File Id="OrcaExe" Source="dist\orca.exe" KeyPath="yes" />
        <Environment
          Id="OrcaPath"
          Name="PATH"
          Value="[INSTALLFOLDER]"
          Part="last"
          Action="set"
          System="yes"
        />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="OrcaShortcuts" Directory="OrcaProgramMenuFolder">
      <Component Id="OrcaUninstallShortcutComponent" Guid="*">
        <Shortcut
          Id="OrcaUninstallShortcut"
          Name="Uninstall Orca"
          Target="[SystemFolder]msiexec.exe"
          Arguments="/x [ProductCode]"
        />
        <RemoveFolder Id="OrcaProgramMenuFolderRemove" Directory="OrcaProgramMenuFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\vanthaita\Orca" Name="Installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Package>
</Wix>
